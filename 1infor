import axios from 'axios';

const API_BASE_URL = 'http://localhost:8080/api/users';
const AUTH_API_BASE_URL = 'http://localhost:8080/api/auth';

const userService = {
  getByEmail: async (email) => {
    const res = await axios.get(`${API_BASE_URL}/${encodeURIComponent(email)}`);
    return res.data;
  },
  
  // Get total users count from users table via auth API
  getTotalUsersCount: async () => {
    try {
      // Try different possible endpoints for users count
      let res;
      
      try {
        // Try auth/users/count endpoint
        res = await axios.get(`${AUTH_API_BASE_URL}/users/count`);
        return res.data.count || res.data.total || 0;
      } catch (e1) {
        try {
          // Try auth/users endpoint and count on frontend
          res = await axios.get(`${AUTH_API_BASE_URL}/users`);
          if (Array.isArray(res.data)) {
            return res.data.length;
          }
          return res.data.count || res.data.total || 0;
        } catch (e2) {
          try {
            // Try original users endpoint
            res = await axios.get(`${API_BASE_URL}`);
            if (Array.isArray(res.data)) {
              return res.data.length;
            }
            return res.data.count || res.data.total || 0;
          } catch (e3) {
            // Last try - users count endpoint
            res = await axios.get(`${API_BASE_URL}/count`);
            return res.data.count || res.data.total || 0;
          }
        }
      }
    } catch (error) {
      console.error('Error fetching total users count:', error);
      return 0;
    }
  }
};

export default userService;

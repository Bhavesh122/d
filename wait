import axios from 'axios';

const API_BASE_URL = 'http://localhost:8080/api';

// Create an axios instance and attach JWT from sessionStorage/localStorage
const api = axios.create({ baseURL: API_BASE_URL });
api.interceptors.request.use((config) => {
    const token = (typeof sessionStorage !== 'undefined' && sessionStorage.getItem('token'))
        || (typeof localStorage !== 'undefined' && localStorage.getItem('token'))
        || null;
    if (token) {
        config.headers = config.headers || {};
        config.headers['Authorization'] = `Bearer ${token}`;
    }
    return config;
});

const folderService = {
    // Get all folders in reports directory
    listReportFolders: async () => {
        try {
            const response = await api.get(`/folders`);
            return response.data;
        } catch (error) {
            console.error('Error fetching report folders:', error);
            throw error;
        }
    },

    // Get files in a specific folder
    listFilesInFolder: async (folderName) => {
        try {
            const response = await api.get(`/folders/${folderName}/files`);
            return response.data;
        } catch (error) {
            console.error('Error fetching files in folder:', error);
            throw error;
        }
    },

    // Get all files accessible by a user
    getUserAccessibleFiles: async (email) => {
        try {
            const response = await api.get(`/folders/user/${encodeURIComponent(email)}/files`);
            return response.data;
        } catch (error) {
            console.error('Error fetching user accessible files:', error);
            throw error;
        }
    }
};

export default folderService;
